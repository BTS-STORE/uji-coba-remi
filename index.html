<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penghitung Poin Remi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 min-h-screen">
    <!-- Header -->
    <div class="bg-white/10 backdrop-blur-md border-b border-white/20">
        <div class="max-w-6xl mx-auto px-3 py-4">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div>
                    <h1 class="text-xl sm:text-3xl font-bold text-white flex items-center gap-2">
                        üÉè Penghitung Poin Remi
                    </h1>
                    <p class="text-white/60 text-xs sm:text-sm mt-1">BY <span class="text-white font-medium">Irsan R</span></p>
                </div>
                <div class="flex gap-2 flex-wrap w-full sm:w-auto">
                    <button onclick="showAddPlayerModal()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 sm:flex-none">
                        + Tambah
                    </button>

                    <button onclick="showResetModal()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 sm:flex-none">
                        üîÑ Reset
                    </button>
                    <button onclick="showSyncModal()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 sm:flex-none">
                        ‚òÅÔ∏è Sync
                    </button>
                    <a href="https://bit.ly/remibts" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 sm:flex-none text-center">
                        üì± Download APK
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-3 py-4">
        <div class="grid lg:grid-cols-3 gap-4">
            <!-- Daftar Pemain -->
            <div class="lg:col-span-2">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <h2 class="text-lg sm:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                        üë• Daftar Pemain
                    </h2>
                    <div id="playersList" class="space-y-4">
                        <!-- Pemain akan ditambahkan di sini -->
                    </div>
                    <div id="emptyState" class="text-center py-12 text-white/60">
                        <div class="text-6xl mb-4">üéÆ</div>
                        <p class="text-lg">Belum ada pemain. Tambahkan pemain untuk memulai!</p>
                    </div>
                </div>
            </div>

            <!-- Riwayat Poin -->
            <div class="lg:col-span-1">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 p-4 shadow-2xl">
                    <h2 class="text-lg sm:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                        üìä Riwayat Poin
                    </h2>
                    <div id="historyList" class="space-y-3 max-h-64 sm:max-h-96 overflow-y-auto">
                        <div class="text-center py-8 text-white/60">
                            <div class="text-4xl mb-2">üìù</div>
                            <p>Belum ada riwayat</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah Pemain -->
    <div id="addPlayerModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-3 shadow-2xl slide-up">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Tambah Pemain Baru</h3>
            <input type="text" id="playerNameInput" placeholder="Nama pemain..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-lg">
            <div class="flex gap-3 mt-6">
                <button onclick="addPlayer()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-medium transition-colors">
                    Tambah
                </button>
                <button onclick="hideAddPlayerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Reset -->
    <div id="resetModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-3 shadow-2xl slide-up">
            <div class="text-center">
                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Reset Permainan?</h3>
                <p class="text-gray-600 mb-6">Semua poin pemain akan direset ke 0 dan riwayat akan dihapus. Tindakan ini tidak dapat dibatalkan.</p>
                <div class="flex gap-3">
                    <button onclick="resetGame()" class="flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium transition-colors">
                        Ya, Reset
                    </button>
                    <button onclick="hideResetModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit Pemain -->
    <div id="editPlayerModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-3 shadow-2xl slide-up">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Edit Nama Pemain</h3>
            <input type="text" id="editPlayerNameInput" placeholder="Nama pemain..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none text-lg">
            <div class="flex gap-3 mt-6">
                <button onclick="savePlayerEdit()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white py-3 rounded-lg font-medium transition-colors">
                    Simpan
                </button>
                <button onclick="hideEditPlayerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Riwayat Pemain -->
    <div id="playerHistoryModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-lg w-full mx-3 shadow-2xl slide-up max-h-[80vh] overflow-hidden flex flex-col">
            <div class="flex items-center justify-between mb-6">
                <h3 id="playerHistoryTitle" class="text-2xl font-bold text-gray-800">Riwayat Pemain</h3>
                <button onclick="hidePlayerHistoryModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div id="playerHistoryContent" class="flex-1 overflow-y-auto space-y-3">
                <!-- Riwayat pemain akan ditampilkan di sini -->
            </div>
        </div>
    </div>

    <!-- Modal Sync -->
    <div id="syncModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-6 max-w-lg w-full mx-3 shadow-2xl slide-up max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                ‚òÅÔ∏è Sync Data
            </h3>
            
            <div class="mb-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Room ID (4-8 karakter):</label>
                        <input type="text" id="roomIdInput" placeholder="Contoh: REMI123" maxlength="8" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-sm uppercase">
                        <p class="text-gray-500 text-xs mt-1">Kosongkan untuk membuat ID otomatis. Gunakan huruf/angka saja.</p>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-3">Pilih Server:</label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="serverChoice" value="jsonbin" class="mr-3" checked>
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-blue-600">üöÄ</span>
                                        <span class="font-medium text-gray-800">JSONBin Premium</span>
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Recommended</span>
                                    </div>
                                    <p class="text-gray-600 text-xs mt-1">Server premium dengan API key, paling reliable</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="serverChoice" value="pasteee" class="mr-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-purple-600">‚≠ê</span>
                                        <span class="font-medium text-gray-800">Paste.ee Premium</span>
                                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">Premium</span>
                                    </div>
                                    <p class="text-gray-600 text-xs mt-1">Server premium dengan authentication, data tahan 1 bulan</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="serverChoice" value="github" class="mr-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-gray-600">üêô</span>
                                        <span class="font-medium text-gray-800">GitHub Gist</span>
                                        <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">Free</span>
                                    </div>
                                    <p class="text-gray-600 text-xs mt-1">Gratis, anonymous gist, cukup reliable</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="serverChoice" value="dpaste" class="mr-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-orange-600">üìã</span>
                                        <span class="font-medium text-gray-800">dpaste.org</span>
                                        <span class="bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full">Free</span>
                                    </div>
                                    <p class="text-gray-600 text-xs mt-1">Gratis, simple paste service, data tahan 30 hari</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                <input type="radio" name="serverChoice" value="auto" class="mr-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2">
                                        <span class="text-green-600">üéØ</span>
                                        <span class="font-medium text-gray-800">Auto (Multi-Server)</span>
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Smart</span>
                                    </div>
                                    <p class="text-gray-600 text-xs mt-1">Coba semua server secara otomatis sampai berhasil</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div id="syncStatus" class="text-center py-2">
                        <span id="syncStatusText" class="text-gray-600 text-sm">Pilih server dan masukkan Room ID untuk mulai sync</span>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="uploadToServer()" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-lg font-medium transition-colors">
                    ‚¨ÜÔ∏è Upload
                </button>
                <button onclick="downloadFromServer()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-colors">
                    ‚¨áÔ∏è Download
                </button>
                <button onclick="hideSyncModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let history = [];
        let editingPlayerId = null;

        // Fungsi untuk menyimpan data ke localStorage
        function saveToLocalStorage() {
            const data = {
                players: players,
                history: history,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('remiGameData', JSON.stringify(data));
        }

        // Fungsi untuk memuat data dari localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('remiGameData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    players = data.players || [];
                    history = data.history || [];
                    renderPlayers();
                    renderHistory();
                } catch (e) {
                    console.error('Error loading data from localStorage:', e);
                }
            }
        }

        // Fungsi untuk menampilkan/menyembunyikan modal
        function showAddPlayerModal() {
            document.getElementById('addPlayerModal').classList.remove('hidden');
            document.getElementById('addPlayerModal').classList.add('flex');
            document.getElementById('playerNameInput').focus();
        }

        function hideAddPlayerModal() {
            document.getElementById('addPlayerModal').classList.add('hidden');
            document.getElementById('addPlayerModal').classList.remove('flex');
            document.getElementById('playerNameInput').value = '';
        }

        function showResetModal() {
            document.getElementById('resetModal').classList.remove('hidden');
            document.getElementById('resetModal').classList.add('flex');
        }

        function hideResetModal() {
            document.getElementById('resetModal').classList.add('hidden');
            document.getElementById('resetModal').classList.remove('flex');
        }

        function showEditPlayerModal(playerId) {
            editingPlayerId = playerId;
            const player = players.find(p => p.id === playerId);
            document.getElementById('editPlayerNameInput').value = player.name;
            document.getElementById('editPlayerModal').classList.remove('hidden');
            document.getElementById('editPlayerModal').classList.add('flex');
            document.getElementById('editPlayerNameInput').focus();
        }

        function hideEditPlayerModal() {
            document.getElementById('editPlayerModal').classList.add('hidden');
            document.getElementById('editPlayerModal').classList.remove('flex');
            editingPlayerId = null;
        }

        function showPlayerHistory(playerId) {
            const player = players.find(p => p.id === playerId);
            const playerHistory = history.filter(h => h.text.includes(player.name));
            
            document.getElementById('playerHistoryTitle').textContent = `Riwayat - ${player.name}`;
            
            const content = document.getElementById('playerHistoryContent');
            if (playerHistory.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">üìù</div>
                        <p>Belum ada riwayat untuk ${player.name}</p>
                    </div>
                `;
            } else {
                content.innerHTML = playerHistory.map(item => `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="text-gray-800 text-sm">${item.text}</div>
                        <div class="text-gray-500 text-xs mt-2">${item.time}</div>
                    </div>
                `).join('');
            }
            
            document.getElementById('playerHistoryModal').classList.remove('hidden');
            document.getElementById('playerHistoryModal').classList.add('flex');
        }

        function hidePlayerHistoryModal() {
            document.getElementById('playerHistoryModal').classList.add('hidden');
            document.getElementById('playerHistoryModal').classList.remove('flex');
        }

        function showSyncModal() {
            // Load saved room ID
            const savedRoomId = localStorage.getItem('remiRoomId');
            if (savedRoomId) {
                document.getElementById('roomIdInput').value = savedRoomId;
            }
            document.getElementById('syncModal').classList.remove('hidden');
            document.getElementById('syncModal').classList.add('flex');
            
            // Update status based on selected server
            updateServerStatus();
        }

        function updateServerStatus() {
            const selectedServer = document.querySelector('input[name="serverChoice"]:checked').value;
            const serverNames = {
                'jsonbin': 'JSONBin Premium',
                'pasteee': 'Paste.ee Premium', 
                'github': 'GitHub Gist',
                'dpaste': 'dpaste.org',
                'auto': 'Multi-Server (Auto)'
            };
            
            const serverName = serverNames[selectedServer] || 'Unknown';
            updateSyncStatus(`Siap untuk sync dengan ${serverName}`, false);
        }

        function hideSyncModal() {
            document.getElementById('syncModal').classList.add('hidden');
            document.getElementById('syncModal').classList.remove('flex');
        }

        function updateSyncStatus(message, isError = false) {
            const statusText = document.getElementById('syncStatusText');
            statusText.textContent = message;
            statusText.className = isError ? 'text-red-600 text-sm' : 'text-green-600 text-sm';
        }

        // Helper function to check if room ID already exists
        async function checkRoomIdExists(roomId, serverType) {
            try {
                switch (serverType) {
                    case 'jsonbin':
                        const binId = localStorage.getItem(`remi_bin_${roomId}`);
                        if (binId) {
                            const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                                headers: {
                                    'X-Master-Key': '$2a$10$PsbU/3jgHeApo.8Vwq4uUesrec7uXc879BjlWLEzXy4lzVkvlLi7K'
                                }
                            });
                            return response.ok;
                        }
                        break;
                    case 'pasteee':
                        const pasteId = localStorage.getItem(`remi_paste_${roomId}`);
                        if (pasteId) {
                            const response = await fetch(`https://api.paste.ee/v1/pastes/${pasteId}`, {
                                headers: {
                                    'X-Auth-Token': 'ukFdEcSyO5CUdpRL5zvn7UUuE4wfIP36rQT9V8Ssf'
                                }
                            });
                            return response.ok;
                        }
                        break;
                    case 'github':
                        const gistId = localStorage.getItem(`remi_gist_${roomId}`);
                        if (gistId) {
                            const response = await fetch(`https://api.github.com/gists/${gistId}`);
                            return response.ok;
                        }
                        break;
                    case 'dpaste':
                        const dpasteId = localStorage.getItem(`remi_dpaste_${roomId}`);
                        if (dpasteId) {
                            const response = await fetch(`https://dpaste.org/${dpasteId}.txt`);
                            return response.ok;
                        }
                        break;
                }
                return false;
            } catch (e) {
                return false;
            }
        }

        // Upload to specific server
        async function uploadToSpecificServer(roomId, data, serverType) {
            const payload = {
                roomId: roomId,
                gameData: data,
                timestamp: Date.now(),
                version: '2.0'
            };

            switch (serverType) {
                case 'jsonbin':
                    updateSyncStatus('üì§ Upload ke JSONBin Premium...', false);
                    const response = await fetch('https://api.jsonbin.io/v3/b', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Master-Key': '$2a$10$PsbU/3jgHeApo.8Vwq4uUesrec7uXc879BjlWLEzXy4lzVkvlLi7K',
                            'X-Bin-Name': `remi-game-${roomId}`,
                            'X-Bin-Private': 'false',
                            'X-Collection-Id': '674b8e15ad19ca34f8c8f8c5'
                        },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const binId = result.metadata?.id || result.id;
                        if (binId) {
                            localStorage.setItem(`remi_bin_${roomId}`, binId);
                            return { success: true, url: `https://api.jsonbin.io/v3/b/${binId}`, server: 'JSONBin Premium' };
                        }
                    }
                    throw new Error('JSONBin upload failed');

                case 'pasteee':
                    updateSyncStatus('üì§ Upload ke Paste.ee Premium...', false);
                    const pasteResponse = await fetch('https://api.paste.ee/v1/pastes', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Auth-Token': 'ukFdEcSyO5CUdpRL5zvn7UUuE4wfIP36rQT9V8Ssf'
                        },
                        body: JSON.stringify({
                            description: `Remi Game Data - Room ${roomId}`,
                            sections: [{
                                name: `remi-game-${roomId}.json`,
                                syntax: 'json',
                                contents: JSON.stringify(payload, null, 2)
                            }],
                            expiration: '1M'
                        })
                    });

                    if (pasteResponse.ok) {
                        const result = await pasteResponse.json();
                        localStorage.setItem(`remi_paste_${roomId}`, result.id);
                        return { success: true, url: result.link, server: 'Paste.ee Premium' };
                    }
                    throw new Error('Paste.ee upload failed');

                case 'github':
                    updateSyncStatus('üì§ Upload ke GitHub Gist...', false);
                    const gistResponse = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            description: `Remi Game Data - ${roomId}`,
                            public: false,
                            files: {
                                [`remi-${roomId}.json`]: {
                                    content: JSON.stringify(payload, null, 2)
                                }
                            }
                        })
                    });

                    if (gistResponse.ok) {
                        const result = await gistResponse.json();
                        localStorage.setItem(`remi_gist_${roomId}`, result.id);
                        return { success: true, url: result.html_url, server: 'GitHub Gist' };
                    }
                    throw new Error('GitHub Gist upload failed');

                case 'dpaste':
                    updateSyncStatus('üì§ Upload ke dpaste.org...', false);
                    const formData = new FormData();
                    formData.append('content', JSON.stringify(payload));
                    formData.append('syntax', 'json');
                    formData.append('title', `Remi Game - ${roomId}`);
                    formData.append('expiry_days', '30');

                    const dpasteResponse = await fetch('https://dpaste.org/api/', {
                        method: 'POST',
                        body: formData
                    });

                    if (dpasteResponse.ok) {
                        const pasteUrl = await dpasteResponse.text();
                        if (pasteUrl.trim().startsWith('https://dpaste.org/')) {
                            const pasteId = pasteUrl.trim().split('/').pop();
                            localStorage.setItem(`remi_dpaste_${roomId}`, pasteId);
                            return { success: true, url: pasteUrl.trim(), server: 'dpaste.org' };
                        }
                    }
                    throw new Error('dpaste upload failed');

                default:
                    throw new Error('Unknown server type');
            }
        }

        // Main upload function with server selection
        async function uploadToServer() {
            try {
                let roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
                const selectedServer = document.querySelector('input[name="serverChoice"]:checked').value;
                
                const data = {
                    players: players,
                    history: history,
                    lastUpdated: new Date().toISOString(),
                    version: '2.0'
                };

                // Validate and generate room ID
                if (!roomId) {
                    roomId = Math.random().toString(36).substr(2, 6).toUpperCase();
                } else {
                    roomId = roomId.replace(/[^A-Z0-9]/g, '').substr(0, 8);
                    if (roomId.length < 4) {
                        updateSyncStatus('‚ùå Room ID minimal 4 karakter!', true);
                        return;
                    }
                }

                // Check if room ID already exists for selected server
                if (selectedServer !== 'auto') {
                    updateSyncStatus('üîç Cek ketersediaan Room ID...', false);
                    const exists = await checkRoomIdExists(roomId, selectedServer);
                    if (exists) {
                        updateSyncStatus(`‚ùå Room ID "${roomId}" sudah ada di ${selectedServer}! Gunakan Room ID lain.`, true);
                        return;
                    }
                }

                let success = false;
                let uploadResult = null;

                if (selectedServer === 'auto') {
                    // Try all servers in order
                    const servers = ['jsonbin', 'pasteee', 'github', 'dpaste'];
                    
                    for (let server of servers) {
                        // Check if room exists on this server
                        const exists = await checkRoomIdExists(roomId, server);
                        if (exists) {
                            updateSyncStatus(`‚ö†Ô∏è Room ID "${roomId}" sudah ada di ${server}, coba server lain...`, false);
                            continue;
                        }

                        try {
                            uploadResult = await uploadToSpecificServer(roomId, data, server);
                            if (uploadResult.success) {
                                success = true;
                                break;
                            }
                        } catch (e) {
                            console.log(`${server} failed:`, e.message);
                            continue;
                        }
                    }

                    if (!success) {
                        // All servers failed or room exists everywhere
                        updateSyncStatus(`‚ùå Room ID "${roomId}" sudah ada di semua server atau gagal upload. Coba Room ID lain.`, true);
                        return;
                    }
                } else {
                    // Upload to specific server
                    try {
                        uploadResult = await uploadToSpecificServer(roomId, data, selectedServer);
                        success = uploadResult.success;
                    } catch (e) {
                        updateSyncStatus(`‚ùå Upload ke ${selectedServer} gagal: ${e.message}`, true);
                        return;
                    }
                }

                if (success && uploadResult) {
                    document.getElementById('roomIdInput').value = roomId;
                    localStorage.setItem('remiRoomId', roomId);
                    
                    updateSyncStatus(`‚úÖ Upload berhasil ke ${uploadResult.server}! Room ID: ${roomId}`, false);
                    
                    // Auto copy room ID to clipboard
                    try {
                        await navigator.clipboard.writeText(roomId);
                        updateSyncStatus(`‚úÖ Room ID disalin: ${roomId} - Bagikan ke perangkat lain!`, false);
                    } catch (e) {
                        const textarea = document.createElement('textarea');
                        textarea.value = roomId;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        updateSyncStatus(`‚úÖ Room ID disalin: ${roomId} - Bagikan ke perangkat lain!`, false);
                    }
                } else {
                    throw new Error('Upload failed');
                }

            } catch (error) {
                console.error('Upload error:', error);
                updateSyncStatus('‚ùå Gagal upload. Coba lagi atau periksa koneksi internet.', true);
            }
        }

        // Helper function to extract and validate game data
        function extractGameData(rawData) {
            if (!rawData) return null;
            
            // Try different data structures
            let gameData = null;
            
            // Direct structure
            if (rawData.players && Array.isArray(rawData.players)) {
                gameData = rawData;
            }
            // Nested in gameData
            else if (rawData.gameData && rawData.gameData.players) {
                gameData = rawData.gameData;
            }
            // Nested in data
            else if (rawData.data && rawData.data.players) {
                gameData = rawData.data;
            }
            // Nested deeper
            else if (rawData.record && rawData.record.gameData && rawData.record.gameData.players) {
                gameData = rawData.record.gameData;
            }
            // JSONBin structure
            else if (rawData.record && rawData.record.players) {
                gameData = rawData.record;
            }
            
            // Validate structure
            if (gameData && gameData.players && Array.isArray(gameData.players)) {
                return {
                    players: gameData.players,
                    history: gameData.history || [],
                    lastUpdated: gameData.lastUpdated || new Date().toISOString()
                };
            }
            
            return null;
        }

        // Download from specific server
        async function downloadFromSpecificServer(roomId, serverType) {
            switch (serverType) {
                case 'jsonbin':
                    updateSyncStatus('‚òÅÔ∏è Download dari JSONBin Premium...', false);
                    const binId = localStorage.getItem(`remi_bin_${roomId}`);
                    if (!binId) throw new Error('Bin ID tidak ditemukan');
                    
                    const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                        headers: {
                            'X-Master-Key': '$2a$10$PsbU/3jgHeApo.8Vwq4uUesrec7uXc879BjlWLEzXy4lzVkvlLi7K'
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        const extracted = extractGameData(result);
                        if (extracted) {
                            return { success: true, data: extracted, server: 'JSONBin Premium' };
                        }
                    }
                    throw new Error('Data tidak valid dari JSONBin');

                case 'pasteee':
                    updateSyncStatus('‚òÅÔ∏è Download dari Paste.ee Premium...', false);
                    const pasteId = localStorage.getItem(`remi_paste_${roomId}`);
                    if (!pasteId) throw new Error('Paste ID tidak ditemukan');
                    
                    const pasteResponse = await fetch(`https://api.paste.ee/v1/pastes/${pasteId}`, {
                        headers: {
                            'X-Auth-Token': 'ukFdEcSyO5CUdpRL5zvn7UUuE4wfIP36rQT9V8Ssf'
                        }
                    });
                    
                    if (pasteResponse.ok) {
                        const result = await pasteResponse.json();
                        if (result.paste && result.paste.sections && result.paste.sections[0]) {
                            const content = JSON.parse(result.paste.sections[0].contents);
                            const extracted = extractGameData(content);
                            if (extracted) {
                                return { success: true, data: extracted, server: 'Paste.ee Premium' };
                            }
                        }
                    }
                    throw new Error('Data tidak valid dari Paste.ee');

                case 'github':
                    updateSyncStatus('‚òÅÔ∏è Download dari GitHub Gist...', false);
                    const gistId = localStorage.getItem(`remi_gist_${roomId}`);
                    if (!gistId) throw new Error('Gist ID tidak ditemukan');
                    
                    const gistResponse = await fetch(`https://api.github.com/gists/${gistId}`);
                    
                    if (gistResponse.ok) {
                        const result = await gistResponse.json();
                        const fileName = Object.keys(result.files)[0];
                        const content = JSON.parse(result.files[fileName].content);
                        const extracted = extractGameData(content);
                        if (extracted) {
                            return { success: true, data: extracted, server: 'GitHub Gist' };
                        }
                    }
                    throw new Error('Data tidak valid dari GitHub Gist');

                case 'dpaste':
                    updateSyncStatus('‚òÅÔ∏è Download dari dpaste.org...', false);
                    const dpasteId = localStorage.getItem(`remi_dpaste_${roomId}`);
                    if (!dpasteId) throw new Error('dpaste ID tidak ditemukan');
                    
                    const dpasteResponse = await fetch(`https://dpaste.org/${dpasteId}.txt`);
                    
                    if (dpasteResponse.ok) {
                        const content = await dpasteResponse.text();
                        const parsed = JSON.parse(content);
                        const extracted = extractGameData(parsed);
                        if (extracted) {
                            return { success: true, data: extracted, server: 'dpaste.org' };
                        }
                    }
                    throw new Error('Data tidak valid dari dpaste');

                default:
                    throw new Error('Server type tidak dikenal');
            }
        }

        // Main download function with server selection
        async function downloadFromServer() {
            try {
                let roomId = document.getElementById('roomIdInput').value.trim().toUpperCase();
                const selectedServer = document.querySelector('input[name="serverChoice"]:checked').value;
                
                if (!roomId) {
                    updateSyncStatus('‚ùå Masukkan Room ID terlebih dahulu!', true);
                    return;
                }

                // Clean room ID
                roomId = roomId.replace(/[^A-Z0-9]/g, '');

                let data = null;
                let success = false;
                let foundMethod = '';

                if (selectedServer === 'auto') {
                    // Try all servers in order
                    const servers = ['jsonbin', 'pasteee', 'github', 'dpaste'];
                    
                    for (let server of servers) {
                        try {
                            const result = await downloadFromSpecificServer(roomId, server);
                            if (result.success) {
                                data = result.data;
                                foundMethod = result.server;
                                success = true;
                                break;
                            }
                        } catch (e) {
                            console.log(`${server} download failed:`, e.message);
                            continue;
                        }
                    }

                    // If no server worked, try local storage
                    if (!success) {
                        updateSyncStatus('üì± Cek penyimpanan lokal...', false);
                        const localVariations = [
                            `remi_room_${roomId}`,
                            `remi_share_${roomId}`,
                            `remi_backup_${roomId}`,
                            `remiGameData_${roomId}`,
                            `remi-${roomId}`
                        ];

                        for (let key of localVariations) {
                            const localData = localStorage.getItem(key);
                            if (localData) {
                                try {
                                    const parsed = JSON.parse(localData);
                                    const extracted = extractGameData(parsed);
                                    if (extracted) {
                                        data = extracted;
                                        success = true;
                                        foundMethod = 'Local Storage';
                                        break;
                                    }
                                } catch (e) {
                                    continue;
                                }
                            }
                        }
                    }
                } else {
                    // Download from specific server
                    try {
                        const result = await downloadFromSpecificServer(roomId, selectedServer);
                        if (result.success) {
                            data = result.data;
                            foundMethod = result.server;
                            success = true;
                        }
                    } catch (e) {
                        updateSyncStatus(`‚ùå Download dari ${selectedServer} gagal: ${e.message}`, true);
                        return;
                    }
                }

                // Process results
                if (!success || !data) {
                    updateSyncStatus('‚ùå Room ID tidak ditemukan! Pastikan Room ID benar dan sudah diupload.', true);
                    
                    // Show helpful message
                    setTimeout(() => {
                        updateSyncStatus('üí° Tips: Coba server lain atau pastikan Room ID sudah diupload', false);
                    }, 3000);
                    return;
                }

                updateSyncStatus(`‚úÖ Data ditemukan di ${foundMethod}! Konfirmasi download...`, false);

                if (confirm(`Data ditemukan di ${foundMethod}!\n\nPemain: ${data.players.length}\nRiwayat: ${data.history.length} entri\n\nDownload akan mengganti semua data yang ada. Lanjutkan?`)) {
                    players = data.players;
                    history = data.history || [];
                    
                    // Save room ID for future use
                    localStorage.setItem('remiRoomId', roomId);
                    
                    saveToLocalStorage();
                    renderPlayers();
                    renderHistory();
                    
                    updateSyncStatus(`‚úÖ Data berhasil didownload dari ${foundMethod}!`, false);
                } else {
                    updateSyncStatus('Download dibatalkan', false);
                }

            } catch (error) {
                console.error('Download error:', error);
                updateSyncStatus('‚ùå Gagal download. Periksa Room ID dan koneksi internet.', true);
            }
        }

        // Fungsi untuk menambah pemain
        function addPlayer() {
            const nameInput = document.getElementById('playerNameInput');
            const name = nameInput.value.trim();
            
            if (name === '') {
                alert('Nama pemain tidak boleh kosong!');
                return;
            }

            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                alert('Nama pemain sudah ada!');
                return;
            }

            const newPlayer = {
                id: Date.now(),
                name: name,
                score: 0
            };

            players.push(newPlayer);
            
            saveToLocalStorage();
            renderPlayers();
            hideAddPlayerModal();
        }

        // Fungsi untuk mengedit nama pemain
        function savePlayerEdit() {
            const nameInput = document.getElementById('editPlayerNameInput');
            const newName = nameInput.value.trim();
            
            if (newName === '') {
                alert('Nama pemain tidak boleh kosong!');
                return;
            }

            if (players.some(p => p.name.toLowerCase() === newName.toLowerCase() && p.id !== editingPlayerId)) {
                alert('Nama pemain sudah ada!');
                return;
            }

            const player = players.find(p => p.id === editingPlayerId);
            const oldName = player.name;
            player.name = newName;
            
            saveToLocalStorage();
            renderPlayers();
            hideEditPlayerModal();
        }

        // Fungsi untuk menghapus pemain
        function deletePlayer(playerId) {
            if (confirm('Yakin ingin menghapus pemain ini?')) {
                const player = players.find(p => p.id === playerId);
                players = players.filter(p => p.id !== playerId);
                saveToLocalStorage();
                renderPlayers();
            }
        }

        // Fungsi untuk memutar efek suara
        function playSound(frequency, duration = 200) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
            } catch (error) {
                // Jika browser tidak mendukung Web Audio API, abaikan error
                console.log('Audio not supported');
            }
        }

        // Fungsi untuk mengubah poin
        function changeScore(playerId, change) {
            const player = players.find(p => p.id === playerId);
            player.score += change;
            
            // Putar efek suara
            if (change > 0) {
                playSound(800); // Nada tinggi untuk tambah poin
            } else {
                playSound(400); // Nada rendah untuk kurang poin
            }
            
            const changeText = change > 0 ? `+${change}` : `${change}`;
            const emoji = change > 0 ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è';
            addToHistory(`${emoji} ${player.name}: ${changeText} poin (Total: ${player.score})`);
            
            saveToLocalStorage();
            renderPlayers();
        }

        // Fungsi untuk menambah poin dengan input inline
        function addPoints(playerId) {
            const pointInput = document.getElementById(`pointInput_${playerId}`);
            const points = parseInt(pointInput.value);
            
            if (isNaN(points) || points <= 0) {
                alert('Masukkan jumlah poin yang valid (lebih dari 0)!');
                return;
            }
            
            changeScore(playerId, points);
            pointInput.value = '';
        }

        // Fungsi untuk mengurangi poin dengan input inline
        function subtractPoints(playerId) {
            const pointInput = document.getElementById(`pointInput_${playerId}`);
            const points = parseInt(pointInput.value);
            
            if (isNaN(points) || points <= 0) {
                alert('Masukkan jumlah poin yang valid (lebih dari 0)!');
                return;
            }
            
            changeScore(playerId, -points);
            pointInput.value = '';
        }

        // Fungsi untuk menambah ke riwayat
        function addToHistory(text) {
            const now = new Date();
            const time = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            history.unshift({ text, time });
            renderHistory();
        }

        // Fungsi untuk reset permainan
        function resetGame() {
            players.forEach(player => player.score = 0);
            history = [];
            saveToLocalStorage();
            renderPlayers();
            renderHistory();
            hideResetModal();
        }

        // Fungsi untuk render pemain
        function renderPlayers() {
            const playersList = document.getElementById('playersList');
            const emptyState = document.getElementById('emptyState');
            
            if (players.length === 0) {
                playersList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            
            // Urutkan pemain berdasarkan skor tertinggi
            const sortedPlayers = [...players].sort((a, b) => b.score - a.score);
            
            playersList.innerHTML = sortedPlayers.map((player, index) => {
                const rankEmoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : 'üë§';
                return `
                    <div class="bg-white/20 backdrop-blur-sm rounded-xl p-4 border border-white/30 fade-in">
                        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 gap-3">
                            <div class="flex items-center gap-3">
                                <span class="text-xl sm:text-2xl">${rankEmoji}</span>
                                <div>
                                    <h3 class="text-lg sm:text-xl font-semibold text-white">${player.name}</h3>
                                    <p class="text-white/70 text-sm">Peringkat ${index + 1}</p>
                                </div>
                            </div>
                            <div class="flex items-center justify-center gap-2 w-full sm:w-auto sm:justify-end">
                                <button onclick="showPlayerHistory(${player.id})" class="text-white/70 hover:text-white transition-colors p-2 text-sm" title="Lihat Riwayat">
                                    üìä
                                </button>
                                <button onclick="showEditPlayerModal(${player.id})" class="text-white/70 hover:text-white transition-colors p-2 text-sm" title="Edit Nama">
                                    ‚úèÔ∏è
                                </button>
                                <button onclick="deletePlayer(${player.id})" class="text-red-400 hover:text-red-300 transition-colors p-2 text-sm" title="Hapus Pemain">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                        
                        <!-- Poin di atas -->
                        <div class="text-center bg-white/10 rounded-xl p-4 mb-4">
                            <div class="text-5xl sm:text-6xl font-bold mb-1 ${player.score < 0 ? 'text-red-400' : 'text-white'}">${player.score}</div>
                            <div class="text-white/70 text-sm sm:text-base font-medium">POIN</div>
                        </div>
                        
                        <!-- Kontrol tambah/kurang di bawah -->
                        <div class="flex items-center gap-2 justify-center">
                            <button onclick="subtractPoints(${player.id})" class="bg-red-500 hover:bg-red-600 text-white py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 max-w-[100px]">
                                - Kurang
                            </button>
                            <input type="number" id="pointInput_${player.id}" placeholder="0" min="1" class="w-20 px-3 py-2 border border-white/30 rounded-lg bg-white/20 text-white text-center placeholder-white/50 focus:ring-2 focus:ring-white/50 focus:border-transparent outline-none text-sm">
                            <button onclick="addPoints(${player.id})" class="bg-emerald-500 hover:bg-emerald-600 text-white py-2 text-sm rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl flex-1 max-w-[100px]">
                                + Tambah
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Fungsi untuk render riwayat
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="text-center py-8 text-white/60">
                        <div class="text-4xl mb-2">üìù</div>
                        <p>Belum ada riwayat</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = history.map(item => `
                <div class="bg-white/10 rounded-lg p-3 border border-white/20 fade-in">
                    <div class="text-white/90 text-sm">${item.text}</div>
                    <div class="text-white/50 text-xs mt-1">${item.time}</div>
                </div>
            `).join('');
        }

        // Event listener untuk Enter key
        document.getElementById('playerNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        document.getElementById('editPlayerNameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                savePlayerEdit();
            }
        });

        // Format room ID input
        document.getElementById('roomIdInput').addEventListener('input', function(e) {
            let value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            if (value.length > 8) value = value.substr(0, 8);
            e.target.value = value;
        });

        // Tutup modal saat klik di luar
        document.getElementById('addPlayerModal').addEventListener('click', function(e) {
            if (e.target === this) hideAddPlayerModal();
        });

        document.getElementById('resetModal').addEventListener('click', function(e) {
            if (e.target === this) hideResetModal();
        });

        document.getElementById('editPlayerModal').addEventListener('click', function(e) {
            if (e.target === this) hideEditPlayerModal();
        });

        document.getElementById('playerHistoryModal').addEventListener('click', function(e) {
            if (e.target === this) hidePlayerHistoryModal();
        });

        document.getElementById('syncModal').addEventListener('click', function(e) {
            if (e.target === this) hideSyncModal();
        });

        // Add event listeners for server selection
        document.addEventListener('DOMContentLoaded', function() {
            const serverRadios = document.querySelectorAll('input[name="serverChoice"]');
            serverRadios.forEach(radio => {
                radio.addEventListener('change', updateServerStatus);
            });
        });

        // Inisialisasi - muat data dari localStorage
        loadFromLocalStorage();
        renderPlayers();
        renderHistory();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97633f1ff149a05d',t:'MTc1NjM3ODIxNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
